<style>
    	body,html{
			height: 100%;
			margin: 0;
			background: #7F7FD5;
	       background: -webkit-linear-gradient(to right, #91EAE4, #86A8E7, #7F7FD5);
	        background: linear-gradient(to right, #91EAE4, #86A8E7, #7F7FD5);
		}

		.chat{
			margin-top: auto;
			margin-bottom: auto;
		}
		.card{
			height: 500px;
			border-radius: 15px !important;
			background-color: rgba(0,0,0,0.4) !important;
		}
		.contacts_body{
			padding:  0.75rem 0 !important;
			overflow-y: auto;
			white-space: nowrap;
		}
		.msg_card_body{
			overflow-y: auto;
		}
		.card-header{
			border-radius: 15px 15px 0 0 !important;
			border-bottom: 0 !important;
		}
	 .card-footer{
		border-radius: 0 0 15px 15px !important;
			border-top: 0 !important;
	}
		.container{
			align-content: center;
		}
		.search{
			border-radius: 15px 0 0 15px !important;
			background-color: rgba(0,0,0,0.3) !important;
			border:0 !important;
			color:white !important;
		}
		.search:focus{
		     box-shadow:none !important;
           outline:0px !important;
		}
		.type_msg{
			background-color: rgba(0,0,0,0.3) !important;
			border:0 !important;
			color:white !important;
			height: 60px !important;
			overflow-y: auto;
		}
			.type_msg:focus{
		     box-shadow:none !important;
           outline:0px !important;
		}
		.attach_btn{
	border-radius: 15px 0 0 15px !important;
	background-color: rgba(0,0,0,0.3) !important;
			border:0 !important;
			color: white !important;
			cursor: pointer;
		}
		.send_btn{
	border-radius: 0 15px 15px 0 !important;
	background-color: rgba(0,0,0,0.3) !important;
			border:0 !important;
			color: white !important;
			cursor: pointer;
		}
		.search_btn{
			border-radius: 0 15px 15px 0 !important;
			background-color: rgba(0,0,0,0.3) !important;
			border:0 !important;
			color: white !important;
			cursor: pointer;
		}
		.contacts{
			list-style: none;
			padding: 0;
		}
		.contacts li{
			width: 100% !important;
			padding: 5px 10px;
			margin-bottom: 15px !important;
		}
	.active{
			background-color: rgba(0,0,0,0.3);
	}
		.user_img{
			height: 70px;
			width: 70px;
			border:1.5px solid #f5f6fa;
		
		}
		.user_img_msg{
			height: 40px;
			width: 40px;
			border:1.5px solid #f5f6fa;
		
		}
	.img_cont{
			position: relative;
			height: 70px;
			width: 70px;
	}
	.img_cont_msg{
			height: 40px;
			width: 40px;
	}
	.user_info{
		margin-top: auto;
		margin-bottom: auto;
		margin-left: 15px;
	}
	.user_info span{
		font-size: 20px;
		color: white;
	}
	.user_info p{
	font-size: 10px;
	color: rgba(255,255,255,0.6);
	}
	.video_cam{
		margin-left: 50px;
		margin-top: 5px;
	}
	.video_cam span{
		color: white;
		font-size: 20px;
		cursor: pointer;
		margin-right: 20px;
	}
	.msg_cotainer{
		margin-top: auto;
		margin-bottom: auto;
		margin-left: 10px;
		border-radius: 25px;
		background-color: #82ccdd;
		padding: 10px;
		position: relative;
	}
	.msg_cotainer_send{
		margin-top: auto;
		margin-bottom: auto;
		margin-right: 10px;
		border-radius: 25px;
		background-color: #78e08f;
		padding: 10px;
		position: relative;
	}
	.msg_time{
		position: absolute;
		left: 0;
		bottom: -15px;
		color: rgba(255,255,255,0.5);
		font-size: 10px;
	}
	.msg_time_send{
		position: absolute;
		right:0;
		bottom: -15px;
		color: rgba(255,255,255,0.5);
		font-size: 10px;
	}
	.msg_head{
		position: relative;
	}
	#action_menu_btn{
		position: absolute;
		right: 10px;
		top: 10px;
		color: white;
		cursor: pointer;
		font-size: 20px;
	}
	.action_menu{
		z-index: 1;
		position: absolute;
		padding: 15px 0;
		background-color: rgba(0,0,0,0.5);
		color: white;
		border-radius: 15px;
		top: 30px;
		right: 15px;
		display: none;
	}
	.action_menu ul{
		list-style: none;
		padding: 0;
	margin: 0;
	}
	.action_menu ul li{
		width: 100%;
		padding: 10px 15px;
		margin-bottom: 5px;
	}
	.action_menu ul li i{
		padding-right: 10px;
	
	}
	.action_menu ul li:hover{
		cursor: pointer;
		background-color: rgba(0,0,0,0.2);
	}
	@media(max-width: 576px){
	.contacts_card{
		margin-bottom: 15px !important;
	}
	}
	.pointer{
		  cursor: pointer;
	}
	.modal-confirm {		
	color: #636363;
	width: 325px;
	font-size: 14px;
}
.modal-confirm .modal-content {
	padding: 20px;
	border-radius: 5px;
	border: none;
}
.modal-confirm .modal-header {
	border-bottom: none;   
	position: relative;
}
.modal-confirm h4 {
	text-align: center;
	font-size: 26px;
	margin: 30px 0 -15px;
}
.modal-confirm .form-control, .modal-confirm .btn {
	min-height: 40px;
	border-radius: 3px; 
}
.modal-confirm .close {
	position: absolute;
	top: -5px;
	right: -5px;
}	
.modal-confirm .modal-footer {
	border: none;
	text-align: center;
	border-radius: 5px;
	font-size: 13px;
}	
.modal-confirm .icon-box {
	color: #fff;		
	position: absolute;
	margin: 0 auto;
	left: 0;
	right: 0;
	top: -70px;
	width: 95px;
	height: 95px;
	border-radius: 50%;
	z-index: 9;
	padding: 15px;
	text-align: center;
	box-shadow: 0px 2px 2px rgba(0, 0, 0, 0.1);
}
.modal-confirm .icon-box i {
	font-size: 58px;
	position: relative;
	top: 3px;
}
.modal-confirm{
	margin-top: 80px;
}
.trigger-btn {
	display: inline-block;
	margin: 100px auto;
}
</style>
<div class="container-fluid h-100">
			<div class="row justify-content-center h-100">
				<div class="col-md-4 col-xl-3 chat"><div class="card mb-sm-3 mb-md-0 contacts_card">
					{{!-- <div class="card-header">
						<div class="input-group">
							<input type="text" placeholder="Search..." name="" class="form-control search">
							<div class="input-group-prepend">
								<span class="input-group-text search_btn"><i class="fas fa-search"></i></span>
							</div>
						</div>
					</div> --}}
					<div class="card-body contacts_body">
						<ui class="contacts">
							{{#if session.lecturer}}
								{{#each usergvs}}
									<li class="active">
										<a href="/message/nhantin/{{this._id}}" class="d-flex bd-highlight">
											<div class="img_cont">
												<img src="https://drive.google.com/thumbnail?id={{this.imgid}}" class="rounded-circle user_img">
											</div>
											<div class="user_info">
												<span>{{this.name}}</span>
											</div>
										</a>
									</li>
								{{/each}}
								{{#each groups}}
									<li class="active">
										<a href="/message/nhantin/{{this._id}}/group" class="d-flex bd-highlight">
											<div class="img_cont">
												<img src="{{this.imglink}}" class="rounded-circle user_img">
											</div>
											<div class="user_info">
												<span>{{this.project.name}}</span>
											</div>
										</a>
									</li>
								{{/each}}
								{{#each usersvs}}
									<li class="active">
										<a href="/message/nhantin/{{this._id}}" class="d-flex bd-highlight">
											<div class="img_cont">
												<img src="https://drive.google.com/thumbnail?id={{this.imgid}}" class="rounded-circle user_img">
											</div>
											<div class="user_info">
												<span>{{this.name}}</span>
											</div>
										</a>
									</li>
								{{/each}}
							{{else}}
							    <li class="active">
                                    <a href="/message/nhantin/{{myinstructor.instructorId._id}}" class="d-flex bd-highlight">
                                        <div class="img_cont">
                                            <img src="https://drive.google.com/thumbnail?id={{myinstructor.instructorId.imgid}}" class="rounded-circle user_img">
                                        </div>
                                        <div class="user_info">
                                            <span>{{myinstructor.instructorId.name}}</span>
                                        </div>
                                    </a>
                                </li>
								<li class="active">
                                    <a href="/message/nhantin/{{group._id}}/group" class="d-flex bd-highlight">
                                        <div class="img_cont">
                                            <img src="{{group.imglink}}" class="rounded-circle user_img">
                                        </div>
                                        <div class="user_info">
                                            <span>{{group.project.name}}</span>
                                        </div>
                                    </a>
                                </li>
								{{#each group.members}}
									{{#unless (eq this._id ../session.userId)}}
										{{#if (eq this.isVerifiedbyInstructor 2)}}
											<li class="active">
												<a href="/message/nhantin/{{this._id}}" class="d-flex bd-highlight">
													<div class="img_cont">
														<img src="https://drive.google.com/thumbnail?id={{this.imgid}}" class="rounded-circle user_img">
													</div>
													<div class="user_info">
														<span>{{this.name}}</span>
													</div>
												</a>
											</li>
										{{/if}}
									{{/unless}}
								{{/each}}
							{{/if}}
						</ui>
					</div>
				</div></div>
				<div class="col-md-8 col-xl-6 chat">
					<div class="card">
						<div class="card-header msg_head">
							<div class="d-flex bd-highlight">
								<div class="img_cont">
									<img src="{{userinfo.imglink}}" class="rounded-circle user_img">
									<span class="online_icon"></span>
								</div>
								<div class="user_info d-flex align-items-center justify-content-center">
									<span>{{userinfo.project.name}}</span>
								</div>
								{{#if session.student}}
									<div class="user_info d-flex align-items-center justify-content-center ml-auto">
										<span><i class="fa-solid fa-circle-check fa-2x pointer" data-toggle='modal' data-target='#vote-complete-project' data-id="{{userinfo._id}}"></i></span>
									</div>
								{{/if}}
							</div>
						</div>
						<div id="messageContainer" class="card-body msg_card_body">
							{{#each contentmessages}}
								<div class="d-flex justify-content-{{#if (eq this.sender ../session.userId)}}end{{else}}start{{/if}} mb-4">
									<div class="msg_cotainer{{#if (eq this.sender ../session.userId)}}_send{{/if}}">
										{{this.content}}
									</div>
								</div>
							{{/each}}
							{{#if votecomplete}}
								{{#if votecomplete.iscompletebylec}}
										<div class="modal-confirm w-100">
											<div class="modal-content">
												<div class="modal-header">
													<div class="icon-box success">
														<i class="fa-solid fa-check"></i>
													</div>				
												</div>
												<div class="modal-body">
													<p class="text-center">Bài đã được người hướng dẩn duyệt.</p>
												</div>
											</div>
										</div>
								{{else}}
									{{#if (eqarr votecomplete.membersisvoted votecomplete.group.members)}}
										<div class="modal-confirm w-100">
											<div class="modal-content">
												<div class="modal-header">
													<div class="icon-box success-faint">
														<i class="fa-solid fa-stopwatch"></i>
													</div>				
												</div>
												<div class="modal-body">
													<p class="text-center">Tất cả thành viên đã bình chọn có, hãy đợi phản hồi từ người hướng dẫn.</p>
												</div>
											</div>
										</div>
									{{else}}
										{{#if kiemtra}}
											<div class="modal-confirm w-100">
												<div class="modal-content">
													<div class="modal-header">
														<div class="icon-box primary">
															<i class="fa-solid fa-hourglass-half"></i>
														</div>				

													</div>
													<div class="modal-body">
														<p class="text-center">Bạn đã bình chọn có.</p>
													</div>
												</div>
											</div>
										{{else}}
											<div class="modal-confirm w-100">
												<div class="modal-content">
													<div class="modal-header">
														<div class="icon-box warning">
															<i class="fa-solid fa-bell"></i>
														</div>				
													</div>
													<div class="modal-body">
														<p class="text-center">Đã có thành viên bình chọn có,nếu bạn đã cảm thấy đồ án hoàn thành thì hãy bình chọn có.</p>
													</div>
												</div>
											</div>
										{{/if}}
									{{/if}}
								{{/if}}
							{{/if}}

						</div>

						<div class="card-footer">
							<div class="input-group">
								<textarea id="input-message" class="form-control type_msg" placeholder="Type your message..."></textarea>
								<div class="input-group-append">
									<button id="send-btn" data-id="{{userinfo._id}}" class="input-group-text send_btn"><i class="fas fa-location-arrow"></i></button>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

<div id="dangerModal" class="modal fade">
	<div class="modal-dialog modal-confirm">
		<div class="modal-content">
			<div class="modal-header">
				<div class="icon-box danger">
					<i class="fa-solid fa-x"></i>
				</div>				
				<h4 class="modal-title w-100">Thất bại!</h4>	
			</div>
			<div class="modal-body">
				<p class="text-center">Bạn đã tham gia bình chọn rồi.</p>
			</div>
			<div class="modal-footer">
				<button class="btn btn-danger btn-block" data-dismiss="modal">OK</button>
			</div>
		</div>
	</div>
</div> 

		
<div id='vote-complete-project' class='modal' tabindex='-1' role='dialog'>
    <div class='modal-dialog modal-dialog-centered' role='document'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h5 class='modal-title'>Tạo bình chọn hoàn thành đồ án</h5>
                <button type='button' class='close' data-dismiss='modal' aria-label='Close'>
                    <span aria-hidden='true'>&times;</span>
                </button>
            </div>
            <div class='modal-body'>
                <p>Cần sự bình chọn của cả 5 người.<br>
                (xác nhận hoàn thành đồ án sẽ gửi đi cho người hướng dẫn với điều kiện cả 5 người điều xác nhận hoàn thành.)</p>
            </div>
            <div class='modal-footer'>
                <button id='btn-vote' type='button' class='btn btn-primary'>Chấp Nhận</button>
                <button type='button' class='btn btn-secondary' data-dismiss='modal'>Hủy</button>
            </div>
        </div>
    </div>
</div>
        <script>
		document.addEventListener("DOMContentLoaded", function () {
			const btnSendmessage = document.getElementById("send-btn")
			const btnVote = document.getElementById("btn-vote")
			btnSendmessage.onclick = function () {
				const content = $("#input-message").val();
				const receiverId = btnSendmessage.dataset.id;
					fetch("/message/sendmessage", {
						method: "POST",
						headers: {
						"Content-Type": "application/json",
						},
						body: JSON.stringify({content,receiverId}),
					}).then((response) => {
						if (response.status === 200) {
						window.location.reload();
						}
					});
			};
			btnVote.onclick = function () {
				const groupId = btnSendmessage.dataset.id;
					fetch("/message/sendvotemessage", {
						method: "POST",
						headers: {
						"Content-Type": "application/json",
						},
						body: JSON.stringify({groupId}),
					}).then((response) => {
						if (response.status === 200) {
						window.location.reload();
						} else {
							$('#vote-complete-project').modal('hide');
                    		$('#dangerModal').modal('show');
						}

					});
			};
			var messageContainer = document.getElementById("messageContainer");
			messageContainer.scrollTop = messageContainer.scrollHeight;

		});
        </script>